阴影与传统渲染与光线追踪


## 零、序 
看起来一般工业用情况下，较少用到渲染；
关注于主干功能的人觉得好的画面只是工业成果中的一种附加价值；
但是其实从一开始任何3D有关设计软件已经开始从渲染的理论建构了软件的各类功能；
不说高级功能，仅仅是光线遮挡造成的阴影，就已经和早期的光线追踪有关；关于物体的遮挡关系依靠光栅化方法从图形学发展早期就达到极高的效率；

传统渲染 -- 传统光追 -- 混合渲染 -- 现代光追

![[attachments/Pasted image 20220307193019.png]]



---
## 一、管线复习
![[attachments/Pasted image 20220307194623.png]]

 
---
> 注意逐像素和逐面的渲染模式
 ![[attachments/Pasted image 20220307194312.png]]
 
---
 ![[attachments/Pasted image 20220307194247.png]]

---
## 二、传统渲染
```
传统渲染分为 环境光 、 漫反射、 高光；
传统渲染，对光的三种分类仅仅是显示的近似模拟；
```
![[attachments/Pasted image 20220307175258.png]]

---
### 0.光强度 
> 详见辐射度量学 之后公式中出现$r^2$不要惊讶
 
![[attachments/Pasted image 20220307185309.png]]

---
### 1.  环境光 ambient
![[attachments/Pasted image 20220307185406.png]]

---
$$L_a = k_a I_a$$
$L_a:环境光$
$k_a:环境光系数$
> 环境光产生是由于光在场景中多次反射的宏观表现；
> 其中包含了大量的漫反射以及少量高光反射；
> 但是传统渲染中不记录二次反射内容，故除了首次反射的光，其余反射的能量计算都被被笼统归为环境光，这种摸棱两可的情况在现代光追技术中会被解决；

---
### 2. 漫反射 diffuse
> 漫反射向四面散射

![[attachments/Pasted image 20220307195248.png]]

--- 
```
在同一位置观察，不同角度入射光的反射能量；
由于光线和表面的法线夹角越大反射的能量越大；
故使用cos函数控制;
``` 
![[attachments/Pasted image 20220307175617.png ]] 

--- 
$$L_d = k_d(\frac{I}{r^2})max(0,\hat{n} \cdot \hat{l})$$
$L_d:漫反射光$
$k_d:粗糙度、漫反射系数$
$\frac{I}{r^2}:照射能量$
$max(0,\hat{n} \cdot \hat{l}):当前方向衰减以及截断函数$
> 由于$\hat{n} \cdot \hat{l} =|n| |l|   \cos\theta$，这里用入射向量和法线的点乘来表达cos函数；
可见光线入射越平缓，则获得能量少反射多；

---
### 3.  高光  specular
> 高光具有方向性；且近似镜面反射，但在出射角可以控制光做到轻微发散；

![[attachments/Pasted image 20220307181738.png]]

---
```
可见观察角度不同 获得高光反射不同;
越是接近镜面反射光路的地方反射能越强;
简单起见，规定入射线和观察视线的角度的半角的向量，称半程向量; 
可见观察视线正好在镜面反射向量重合，则半程向量与反射面法线重合，此时高光最强；
半程向量和视角变化的关系为线性；
此处依旧使用cos函数控制
```
![[attachments/Pasted image 20220307184406.png]]

---
$$L_s = k_s(\frac{I}{r^2})max(0, \cos\alpha)^p$$
$$L_s = k_s(\frac{I}{r^2})max(0, \hat{n} \cdot \hat{h})^p$$
$L_s:高光反射$
$k_s:高光反射系数$
$\frac{I}{r^2}:照射能量$
$\hat{h}:半程向量 \ \hat{h} = \frac{\hat{v}+\hat{l}}{||\hat{v}+\hat{l}||}$
$p: 反射光发散度，代表视角偏离反射向量后的衰减速度$

---
### 4.综合
$$L = L_a+L_d+L_s$$
$$L = k_a I_a + k_d(\frac{I}{r^2})max(0,\hat{n} \cdot \hat{l}) + k_s(\frac{I}{r^2})max(0, \hat{n} \cdot \hat{h})^p$$
 
---
## 三、传统光追原理

![[attachments/Pasted image 20220307202705.png]] 

---
![[attachments/Pasted image 20220307201926.png]]

---
![[attachments/Pasted image 20220307201845.png]]

---
###  1. 方式及强度
> 该部分内容来源于辐射度量学以及上述传统渲染内容，辐射度量学较为繁杂；
 
 
 ![[attachments/Pasted image 20220307201811.png]]
 
---
###  2. 阴影
![[attachments/Pasted image 20220307195725.png]]

---
![[attachments/Pasted image 20220307200458.png]]

---
###  3. 次反射
> 我们常用递归进行多次光线弹射计算
![[attachments/Pasted image 20220307195828.png]]

---
![[attachments/Pasted image 20220307200418.png]]

---
![[attachments/Pasted image 20220307200202.png]]

---



---
###  3. XXX


---
## 四、光追优化
--- 
![[attachments/Pasted image 20220307174316.png]]

--- 
蒙特卡洛随机采样 防止散射数据爆炸
![[attachments/Pasted image 20220307202422.png]]

--- 
每次随机单光路，多次采样叠加
![[attachments/Pasted image 20220307202541.png]]

--- 
多次反射轮盘赌算法，限制光路反射次数
![[attachments/Pasted image 20220307202824.png]]

--- 
![[attachments/Pasted image 20220307202122.png]]

--- 
空间划分  kd-tree   BVH
![[attachments/Pasted image 20220307203004.png]]


--- 
快速算法AABB 轴对齐包围盒
![[attachments/Pasted image 20220307202947.png]]

--- 
![[attachments/Pasted image 20220307203117.png]]

--- 
![[attachments/Pasted image 20220307203048.png]]

---
## 五、 
---




























